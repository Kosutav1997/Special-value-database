<script>
  // Extract discriminant from URL
  const params = new URLSearchParams(window.location.search);
  const D = params.get("D");

  if (!D) {
    document.getElementById("title").textContent =
      "No discriminant specified.";
    throw new Error("Missing discriminant parameter.");
  }

  document.getElementById("title").textContent =
    `CM Discriminant D = ${D}`;

  // Load corresponding JSON
  fetch(`data/D${D}.json`)
    .then(response => {
      if (!response.ok) {
        throw new Error("JSON file not found.");
      }
      return response.json();
    })
    .then(data => {
      const container = document.getElementById("cm-container");
      const cmPoints = data.cm_points;
      const h = data.class_number;

      const block = document.createElement("div");
      block.className = "cm-block";

      // Build table header
      let headerRow = `<tr><th></th>`;
      cmPoints.forEach((_, i) => {
        headerRow += `<th style="text-align:center;">CM Point ${i + 1}</th>`;
      });
      headerRow += `</tr>`;

      // Helper to build rows
      function row(label, values, math=false) {
        let r = `<tr><th>${label}</th>`;
        values.forEach(v => {
          r += math ? `<td>$$${v}$$</td>` : `<td style="text-align:center;">${v}</td>`;
        });
        r += `</tr>`;
        return r;
      }

      block.innerHTML = `
        <table>
          ${headerRow}
          ${row("Class Number", cmPoints.map(() => h))}
          ${row("CM Point $\\tau$", cmPoints.map(c => c.tau), true)}
          ${row("$j(\\tau)$", cmPoints.map(c => c.j_value.exact), true)}
          ${row("$\\eta(\\tau)$", cmPoints.map(c => c.eta_value.exact), true)}
        </table>
      `;

      container.appendChild(block);

      // Render MathJax
      MathJax.typesetPromise();
    })
    .catch(error => {
      document.getElementById("cm-container").innerHTML =
        `<p style="color:red; text-align:center;">
          Failed to load data for discriminant ${D}.
        </p>`;
      console.error(error);
    });
</script>
